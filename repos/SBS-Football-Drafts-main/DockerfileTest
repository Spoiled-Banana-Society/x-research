FROM golang:1.20-alpine

ENV GOOGLE_APPLICATION_CREDENTIALS=./configs/sbs-test-env-config.json
ENV ENVIRONMENT=test
ENV TEST_GCP_CREDS_LOCATION=projects/1026708014901/secrets/sbs-test-env-config/versions/latest
ENV TEST_REDIS_URL_LOCATION=projects/1026708014901/secrets/test-redis-url/versions/latest
ENV TEST_DB_INFO_LOCATION=projects/1026708014901/secrets/sbs-test-env-config/versions/latest
 

COPY . /usr/local/go/src/sbs-drafts-api

WORKDIR /usr/local/go/src/sbs-drafts-api

RUN go mod download

RUN go build -o /sbs-drafts-server

COPY ./configs/sbs-test-env-config.json ./configs/sbs-test-env-config.json

EXPOSE 8000

CMD [ "/sbs-drafts-server" ]